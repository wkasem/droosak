<div class="contacts_wrapper" >
  <div :class="'contact ' + [index == indx ? 'active' : '']"
       v-for='(conversation , index) in conversations'
       @click='changeConversation(index)'>
    <img class="responsive-img circle" src="https://placehold.it/150x150">
    <div class="contact_details">
      <h5>
        <span v-if='conversation.notify_count'>
          {{conversation.notify_count}}
        </span>
        {{ conversation.other_user.first_name }}
        {{ conversation.other_user.last_name }}
      </h5>
      <p class="truncate" v-html="lastMessage(conversation.messages)"></p>

    </div>
  </div>
</div>
<div class="conversation_wrapper">
  <div class="conversation" v-if='conversations.length'>
    <div class="row"
         v-for='message in conversations[indx].messages'
         v-if='conversations[indx].messages.length'>
      <div :class="'col s6 message '  + [hisOwnMessage(message) ? 'me offset-s3' : 'other']">
        <div class="row">
          <div class="col s12">
            <timeago :since="Date.parse(message.created_at)" :auto-update="60" class="right"></timeago>
          </div>
          <div class="col s12">
            <voicenote :msg='message' v-if='message.voiceNote'></voicenote>
            <span v-if='!message.voiceNote'>
              {{ message.body }}
            </span>
          </div>
        </div>
    </div>
  </div>

    <div class="row" v-if='!conversations[indx].messages.length'>
      No Messages
  </div>
</div>
<div class="conversation__action">
  <form v-on:submit.prevent='sendMessage($event)'>
    <input name="body" ref="bodyText"/>
    <button type="submit" class="btn-flat">Send</button>
    <a href="#voiceNote" class="btn">Voice</button>
  </form>
</div>
</div>
</div>

<!-- Modal Structure -->
<div id="voiceNote" class="modal bottom-sheet">
  <div class="modal-content">
    <div class="recorder__wrapper">
      <button class="btn-floating red" @click='voiceNote.start()' v-if='!voiceNote.recordStatus'>
         <i class="material-icons">mic</i>
      </button>
      <button class="btn-floating red"  @click='voiceNote.finish()' v-if='voiceNote.recordStatus'>
        <i class="material-icons">eject</i>
      </button>
      <button class="btn-floating black "  @click='voiceNote.cancel()' v-if='voiceNote.recordStatus'>
         <i class="material-icons">cancel</i>
      </button>
      <span>Click To Start Or Stop Recording</span>
    </div>
  </div>
</div>
